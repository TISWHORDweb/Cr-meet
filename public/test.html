<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC ICE Candidate Test</title>
</head>

<body>
    <h1>WebRTC ICE Candidate Test</h1>
    <pre id="log"></pre>
    <script>
        const iceServers = [{
                urls: 'stun:stun.l.google.com:19302'
            },
            {
                urls: 'turn:13.246.44.15:3478',
                username: 'emmanuel_xolani_aws',
                credential: '=hB9|Dh#123'
            }
        ];

        const config = {
            iceServers: iceServers
        };
        const log = document.getElementById('log');

        let localStream;
        navigator.mediaDevices.getUserMedia({
                video: true,
                audio: true
            })
            .then(stream => {
                localStream = stream;
                const pc = new RTCPeerConnection(config);

                // Add each track from the stream to the peer connection
                localStream.getTracks().forEach(track => pc.addTrack(track, localStream));

                pc.onicecandidate = event => {
                    if (event.candidate) {
                        console.log(`New ICE candidate: ${event.candidate.candidate}`);
                    } else {
                        console.log('All ICE candidates have been gathered');
                    }
                };

                pc.onicecandidateerror = event => {
                    console.error(`ICE candidate error: ${event.errorCode}, ${event.errorText}`);
                };

                pc.createOffer()
                    .then(offer => pc.setLocalDescription(offer))
                    .catch(error => {
                        console.error(`Error: ${error}`);
                    });

                // Handle the remote stream
                pc.ontrack = event => {
                    const remoteVideo = document.createElement('video');
                    remoteVideo.srcObject = event.streams[0];
                    remoteVideo.autoplay = true;
                    document.body.appendChild(remoteVideo);
                };
            })
            .catch(error => {
                console.error('Error accessing media devices.', error);
            });
    </script>
</body>

</html>